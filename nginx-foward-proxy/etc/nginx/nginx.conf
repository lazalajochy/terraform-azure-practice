events {}

http {
    # Define WebSocket connection header mapping at the top level of http
    map $http_upgrade $connection_upgrade {
        default upgrade;
        ''      close;
    }

    server {
        listen 80;
        server_name nginx-gateway.wonderfulsand-18e38eca.eastus.azurecontainerapps.io;

        location /app1/ {
            rewrite ^/app1/?(.*)$ /$1 break;

            proxy_pass https://app1.internal.wonderfulsand-18e38eca.eastus.azurecontainerapps.io/;

            # WebSocket support
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection $connection_upgrade;

            # Forward headers
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # Required for HTTPS upstream
            proxy_ssl_server_name on;
        }

        location / {
            return 200 "Nginx is running\n";
            add_header Content-Type text/plain;
        }
    }
}




#user  nginx;
#worker_processes  auto;

#error_log  /var/log/nginx/error.log notice;
#pid        /run/nginx.pid;


#events {
#    worker_connections  1024;
#}


#http {
#   server {
#        listen 80;
#        server_name localhost;

#        location / {
#                proxy_pass http://host.docker.internal:5173;
#                proxy_http_version 1.1;
#                proxy_set_header Upgrade $http_upgrade;
#                proxy_set_header Connection 'upgrade';
#                proxy_set_header Host $host;
#                proxy_cache_bypass $http_upgrade;

#        }
#        }
#}

